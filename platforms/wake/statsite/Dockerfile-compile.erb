FROM buildpack-deps:jessie-curl

MAINTAINER Nathan Herald <nathan.herald@microsoft.com>

RUN apt-get update \
 && mkdir /opt/app \
 && mkdir /opt/src \
 && echo <%= sha %> > /opt/app/sha

ADD . /opt/src

RUN apt-get install -y make gcc scons \
 && cp -R /opt/src/statsite.d /opt/app/ \
 && cd /opt/src/statsite/ && make && cp ./statsite /opt/app/ \
 && mkdir /opt/app/sinks && cp /opt/src/statsite/sinks/* /opt/app/sinks/

RUN echo <%= start_command %> > /opt/start \
 && chmod +x /opt/start

CMD /opt/start

# CMD docker build -t $RELEASE_IMAGE_NAME $RELEASE_DOCKERFILE
