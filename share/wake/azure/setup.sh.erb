#!/bin/bash

sudo apt-get update
sudo apt-get install htop

# SSH

sudo cp sshd_config /etc/ssh/sshd_config

touch 10-users

<% fetch_collaborators.each do |name, public_key| %>

sudo echo "<%= name %> ALL=(ALL) NOPASSWD:ALL" >> 10-users
sudo adduser --disabled-password --gecos "" <%= name %>
sudo mkdir -p /home/<%= name %>/.ssh
sudo echo "<%= public_key %>" > /home/<%= name %>/.ssh/authorized_keys
sudo chmod 600 /home/<%= name %>/.ssh/authorized_keys
sudo chown -R <%= name %>:<%= name %> /home/<%= name %>

<% end %>

sudo mv 10-users /etc/sudoers.d/
sudo chown root:root /etc/sudoers.d/10-users
sudo chmod 400 /etc/sudoers.d/10-users
